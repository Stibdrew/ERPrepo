{% extends 'users/base.html' %}
{% load crispy_forms_tags %}
{% load static %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/main.css' %}">
<div class="container" style="display: flex;">
    <div class="side-nav" style="background-color: #222; width: 20%; height: 100vh; padding: 20px; color: white;">
        <h3 style="color: white; margin-bottom: 30px;">WEB-BASED</h3>
        <a href="{% url 'inventory' %}" style="display: block; color: white; margin-bottom: 15px;">Inventory</a>


        <!-- Link to the messages list -->
        {% if user.is_superuser %}
        <a class="nav-link active cool-font" aria-current="page" href="{% url 'admin_page' %}">Request Records</a>
        <a class="nav-link active cool-font" aria-current="page" href="{% url 'all_messages' %}">All Messages</a>
        {% endif %}
    </div>

    <div class="main-content" style="width: 80%; padding: 50px;"> <!-- Add main content div -->
        <h2>My Messages and Replies</h2>
        {% if message_replies %}
            <ul class="list-group">
                {% for message, replies in message_replies.items %}
                <li class="list-group-item">
                    <strong>Message:</strong> {{ message.content }}<br>
                    <strong>Sent on:</strong> {{ message.created_at|date:"M d, Y, H:i" }}<br>
                    
                    <strong>Replies:</strong>
                    <ul>
                        {% for reply in replies %}
                        <li>
                            <strong>Replied by:</strong> {{ reply.user.username }}<br>
                            <strong>Reply:</strong> {{ reply.content }}<br>
                            <strong>Replied on:</strong> {{ reply.created_at|date:"M d, Y, H:i" }}<br>
                        </li>
                        {% empty %}
                        <li>No replies yet.</li>
                        {% endfor %}
                    </ul>
                </li>
                {% endfor %}
            </ul>
        {% else %}
            <p>No messages found.</p>
        {% endif %}
    </div> <!-- End of main content div -->
</div>
{% endblock %}
