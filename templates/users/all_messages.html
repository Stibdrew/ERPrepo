{% extends 'users/base.html' %}

{% block content %}
<div class="container mt-5">
    <h2>All Messages</h2>
    {% if messages %}
        <ul class="list-group">
            {% for message in messages %}
                <li class="list-group-item">
                    <strong>Sent by:</strong> {{ message.user.username }}<br>
                    <strong>Message:</strong> {{ message.content }}<br>
                    <strong>Sent on:</strong> {{ message.created_at|date:"M d, Y, H:i" }}<br>

                    <!-- Display replies for this message -->
                    {% if message.replies.all %}
                        <ul class="list-group mt-2">
                            {% for reply in message.replies.all %}
                                <li class="list-group-item">
                                    <strong>Reply by:</strong> {{ reply.user.username }}<br>
                                    <strong>Reply:</strong> {{ reply.content }}<br>
                                    <strong>Replied on:</strong> {{ reply.created_at|date:"M d, Y, H:i" }}<br>
                                </li>
                            {% endfor %}
                        </ul>
                    {% else %}
                        <p>No replies yet.</p>
                    {% endif %}

                    <!-- Reply Form for the current message -->
                    <form action="{% url 'add_reply' message.id %}" method="POST" class="mt-3">
                        {% csrf_token %}
                        {{ reply_form.as_p }}  <!-- This should render the reply form -->
                        <button type="submit" class="btn btn-primary">Reply</button>
                    </form>
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p>No messages found.</p>
    {% endif %}
</div>
{% endblock %}
